<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Home</title>

  <!-- Performance hints -->
  <link rel="preload" href="./assets/wallpaper-dark.jpg" as="image" />
  <link rel="dns-prefetch" href="//www.google.com" />
  <link rel="dns-prefetch" href="//suggestqueries.google.com" />
  <link rel="dns-prefetch" href="//lens.google.com" />
  <link rel="preconnect" href="https://www.google.com" crossorigin />
  <link rel="preconnect" href="https://suggestqueries.google.com" crossorigin />
  <link rel="preconnect" href="https://lens.google.com" crossorigin />

  <style>
    :root{
      --bg: #0c0c0d;
      --bg-elev: #171516;
      --ink: #e9e9ea;
      --ink-dim: #b7b7b9;
      --accent: #6aa3ff;
      --radius-xl: 28px;
      --shadow: 0 12px 60px rgba(0,0,0,.55);
      --shadow-strong: 0 18px 70px rgba(0,0,0,.65);
      --btn: #232224;
      --btn-hover: #2b292c;
      --suggest-bg: rgba(18,17,18,.9);
      --suggest-hover: #1d1b1e;
    }

    /* Base */
    html, body {
      height: 100%;
      background: var(--bg) fixed no-repeat center/cover url("./assets/wallpaper-dark.jpg");
      color: var(--ink);
      font: 16px/1.35 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,Arial,"Apple Color Emoji","Segoe UI Emoji";
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }
    body::before{
      content:"";
      position: fixed; inset: 0;
      background: radial-gradient(1200px 600px at 50% 35%, rgba(0,0,0,.25), rgba(0,0,0,.65) 70%);
      pointer-events: none;
      z-index: 0;
    }

    /* Fixed, top-centered dock for bar + suggestions */
    .dock {
      position: fixed;
      top: 6vh;
      left: 50%;
      transform: translateX(-50%);
      width: min(820px, calc(100vw - 2rem));
      z-index: 10;
    }

    /* Search bar (logo removed) */
    .bar {
      display: grid;
      grid-template-columns: 1fr auto; /* input + actions */
      align-items: center;
      gap: 10px;
      background: rgba(16,14,15,.9);
      border-radius: var(--radius-xl);
      padding: 8px 10px;
      box-shadow: var(--shadow);
      backdrop-filter: saturate(120%) blur(6px);
      position: relative;
      transition: box-shadow .15s ease, transform .15s ease;
      user-select: none;
    }
    .bar.drop-active {
      box-shadow: 0 0 0 2px rgba(106,163,255,.5), var(--shadow-strong);
      transform: translateZ(0);
    }

    /* Remove blue focus outline/highlight */
    .bar:focus-within { box-shadow: var(--shadow); }
    .bar *:focus,
    .bar *:focus-visible { outline: none !important; box-shadow: none !important; }

    .drop-hint {
      position: absolute; inset: 2px;
      border-radius: inherit;
      display: none;
      align-items: center; justify-content: center;
      background: rgba(30,30,40,.25);
      border: 2px dashed rgba(106,163,255,.55);
      color: var(--ink);
      font-size: .95rem;
      pointer-events: none;
      backdrop-filter: blur(2px);
    }
    .bar.drop-active .drop-hint { display: flex; }

    /* Input */
    .form { display: contents; }
    .q {
      width: 100%;
      height: 44px;
      padding: 0 6px;
      color: var(--ink);
      background: transparent;
      border: none;
      outline: none;
      font-size: 1.05rem;
      caret-color: var(--accent);
    }
    .q::placeholder { color: var(--ink-dim); opacity: .6; }

    /* Action cluster (right side) */
    .actions {
      display: flex;
      align-items: center;
      gap: 8px;
      background: var(--bg-elev);
      height: 44px;
      padding: 0 6px 0 10px;
      border-radius: 999px;
    }
    .btn {
      width: 36px; height: 36px;
      display: grid; place-items: center;
      border-radius: 999px;
      background: var(--btn);
      color: var(--ink);
      border: 0;
      cursor: pointer;
      transition: transform .12s ease, background-color .12s ease, opacity .12s ease;
    }
    .btn:hover { background: var(--btn-hover); }
    .btn:active { transform: scale(.96); }
    .btn[disabled] { opacity: .45; cursor: not-allowed; }

    /* Voice recording pulse */
    .voice.recording {
      background: #2f2c32;
      box-shadow: 0 0 0 0 rgba(106,163,255,.35);
      animation: pulse 1.2s infinite;
    }
    @keyframes pulse {
      0% { box-shadow: 0 0 0 0 rgba(106,163,255,.35); }
      70% { box-shadow: 0 0 0 10px rgba(106,163,255,0); }
      100% { box-shadow: 0 0 0 0 rgba(106,163,255,0); }
    }

    /* Lens button slightly larger for balance */
    .lens { width: 40px; height: 40px; }
    .lens svg { width: 20px; height: 20px; }

    /* Right-most AI Mode */
    .ai { width: 44px; height: 44px; margin-left: 4px; }

    /* Suggestions under fixed dock (no layout shift) */
    .suggest {
      position: absolute;
      left: 0; right: 0;
      top: calc(100% + 10px);
      margin: 0;
      padding: 8px;
      list-style: none;
      background: var(--suggest-bg);
      border-radius: 16px;
      box-shadow: 0 10px 40px rgba(0,0,0,.6);
      backdrop-filter: blur(6px) saturate(120%);
      max-height: 50vh;
      overflow: auto;
      display: none;
      z-index: 9;
    }
    .suggest.show { display: block; }
    .suggest li {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 10px 12px;
      border-radius: 10px;
      color: var(--ink);
      cursor: pointer;
      white-space: nowrap;
      text-overflow: ellipsis;
      overflow: hidden;
    }
    .suggest li:hover,
    .suggest li.active { background: var(--suggest-hover); }
    .s-icon { width: 18px; height: 18px; opacity: .7; }

    /* Reduce motion where preferred */
    @media (prefers-reduced-motion: reduce) { .btn { transition: none; } }
  </style>
</head>
<body>
  <!-- Fixed top-center dock -->
  <div class="dock" aria-label="Search dock">
    <div id="bar" class="bar" role="search" aria-label="Search">
      <!-- Search form -->
      <form id="form" class="form" action="https://www.google.com/search" method="GET" autocomplete="off" target="_self">
        <input id="q" class="q" name="q" type="text" inputmode="search" spellcheck="false" aria-label="Search Google" placeholder="Search Google" />
      </form>

      <!-- Actions -->
      <div class="actions" aria-label="Quick actions">
        <!-- Submit (click or Enter) -->
        <button id="go" class="btn go" type="button" title="Search">
          <svg aria-hidden="true" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M3 12h18M12 3l9 9-9 9"></path>
          </svg>
        </button>

        <!-- Voice (fills input only) -->
        <button id="voice" class="btn voice" type="button" title="Search by voice" aria-label="Search by voice">
          <svg aria-hidden="true" width="18" height="18" viewBox="0 0 24 24" fill="none">
            <rect x="9" y="3" width="6" height="10" rx="3" fill="currentColor"/>
            <path d="M5 11a7 7 0 0 0 14 0" stroke="currentColor" stroke-width="1.8" stroke-linecap="round"/>
            <path d="M12 18v3" stroke="currentColor" stroke-width="1.8" stroke-linecap="round"/>
          </svg>
        </button>

        <!-- Lens (balanced icon) -->
        <form id="lensForm" action="https://lens.google.com/upload?ep=ccm" method="POST" enctype="multipart/form-data" target="_blank" style="display:contents">
          <input id="lensFile" type="file" name="encoded_image" accept="image/*" style="display:none" />
          <button id="lensBtn" class="btn lens" type="button" title="Search with an image" aria-label="Search with an image">
            <svg aria-hidden="true" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.7" stroke-linecap="round" stroke-linejoin="round">
              <rect x="3.75" y="3.75" width="16.5" height="16.5" rx="5"/>
              <circle cx="12" cy="12" r="4.25"/>
              <circle cx="15.8" cy="8.2" r="1.1" fill="currentColor" stroke="none" />
            </svg>
          </button>
        </form>

        <!-- AI Mode (right-most) -->
        <button id="ai" class="btn ai" type="button" title="AI Mode">
          <svg aria-hidden="true" width="19" height="19" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <circle cx="11" cy="11" r="6"></circle>
            <path d="M16 16l5 5"></path>
          </svg>
        </button>
      </div>

      <!-- Drag-and-drop overlay hint -->
      <div class="drop-hint">Drop an image to search with Google Lens</div>
    </div>

    <!-- Suggestions live under the fixed bar -->
    <ul id="sugg" class="suggest" role="listbox" aria-label="Search suggestions"></ul>
  </div>

  <script>
    (() => {
      // Shorthand helpers
      const $ = (sel, root=document) => root.querySelector(sel);
      const on = (el, evts, fn) => evts.split(' ').forEach(e => el.addEventListener(e, fn));

      // Elements
      const bar = $('#bar');
      const form = $('#form');
      const q = $('#q');
      const go = $('#go');
      const voice = $('#voice');
      const lensBtn = $('#lensBtn');
      const lensFile = $('#lensFile');
      const lensForm = $('#lensForm');
      const ai = $('#ai');
      const sugg = $('#sugg');

      // Submit search (Enter or button)
      const submitSearch = () => {
        const v = q.value.trim();
        if (!v) { q.focus(); return; }
        form.submit();
      };
      go.addEventListener('click', submitSearch);
      form.addEventListener('submit', (e) => {
        if (!q.value.trim()) { e.preventDefault(); q.focus(); }
      });

      // Suggestions: non-personalized via public endpoint
      const MAX_ITEMS = 8;
      let activeIndex = -1;
      let lastQ = '';
      let inFlight; // AbortController

      const fetchSuggestions = async (text) => {
        try {
          inFlight?.abort();
          inFlight = new AbortController();
          const url = 'https://suggestqueries.google.com/complete/search?client=firefox&hl=en&q=' + encodeURIComponent(text);
          const res = await fetch(url, { signal: inFlight.signal, cache: 'no-store' });
          const data = await res.json();
          return Array.isArray(data?.[1]) ? data[1] : [];
        } catch {
          // Local fallback (very small and generic)
          const base = ["news","weather","maps","translate","time","calculator","currency converter","nearby restaurants","youtube","gmail"];
          const t = text.toLowerCase();
          return base.filter(v => v.includes(t)).slice(0, MAX_ITEMS);
        }
      };

      // Small debounce
      const debounce = (fn, ms=120) => { let t; return (...a)=>{ clearTimeout(t); t=setTimeout(()=>fn(...a),ms); }; };
      const renderSuggestions = (items) => {
        if (!items.length) { sugg.classList.remove('show'); sugg.innerHTML = ''; return; }
        sugg.innerHTML = items.map((text, i) => `
          <li role="option" data-index="${i}" aria-selected="false" title="${text.replace(/"/g,'&quot;')}">
            <svg class="s-icon" viewBox="0 0 24 24" aria-hidden="true"><circle cx="11" cy="11" r="6" fill="currentColor" /></svg>
            <span>${text.replace(/</g,'&lt;')}</span>
          </li>
        `).join('');
        activeIndex = -1;
        sugg.classList.add('show');
      };

      const updateSuggestions = debounce(async (text) => {
        if (!text || text === lastQ) { if (!text) { sugg.classList.remove('show'); sugg.innerHTML=''; } return; }
        lastQ = text;
        const items = (await fetchSuggestions(text)).slice(0, MAX_ITEMS);
        renderSuggestions(items);
      }, 120);

      q.addEventListener('input', e => updateSuggestions(e.target.value.trim()));
      q.addEventListener('focus', () => { const v = q.value.trim(); if (v) updateSuggestions(v); });

      // Keyboard navigation for suggestions
      q.addEventListener('keydown', (e) => {
        const items = Array.from(sugg.querySelectorAll('li'));
        if (!items.length) return;

        if (e.key === 'ArrowDown') {
          e.preventDefault();
          activeIndex = (activeIndex + 1) % items.length;
          setActive(items, activeIndex);
        } else if (e.key === 'ArrowUp') {
          e.preventDefault();
          activeIndex = (activeIndex - 1 + items.length) % items.length;
          setActive(items, activeIndex);
        } else if (e.key === 'Enter') {
          if (activeIndex >= 0) {
            e.preventDefault();
            q.value = items[activeIndex].innerText.trim();
            submitSearch();
          }
        } else if (e.key === 'Escape') {
          sugg.classList.remove('show'); activeIndex = -1;
        }
      });

      const setActive = (items, idx) => {
        items.forEach((li,i) => {
          const on = i === idx;
          li.classList.toggle('active', on);
          li.setAttribute('aria-selected', on ? 'true' : 'false');
          if (on) li.scrollIntoView({ block: 'nearest' });
        });
      };

      // Click suggestion
      sugg.addEventListener('mousedown', (e) => e.preventDefault()); // keep input focus
      sugg.addEventListener('click', (e) => {
        const li = e.target.closest('li'); if (!li) return;
        q.value = li.innerText.trim();
        sugg.classList.remove('show');
        submitSearch();
      });
      q.addEventListener('blur', () => setTimeout(()=>sugg.classList.remove('show'), 120));

      // Voice search: transcribe to input only (no auto-submit)
      voice.addEventListener('click', () => {
        const SR = window.SpeechRecognition || window.webkitSpeechRecognition;
        if (!SR) { alert("Voice search isn't supported in this browser."); return; }

        voice.classList.add('recording');
        voice.disabled = true;

        try {
          const rec = new SR();
          rec.lang = navigator.language || 'en-US';
          rec.interimResults = true;
          rec.maxAlternatives = 1;

          let transcript = q.value;
          rec.onresult = (ev) => {
            const res = ev.results[ev.results.length - 1][0]?.transcript || '';
            if (res) transcript = res;
            q.value = transcript;
            q.focus();
            q.setSelectionRange(q.value.length, q.value.length);
          };
          rec.onerror = () => {};
          rec.onend = () => { voice.classList.remove('recording'); voice.disabled = false; };
          rec.start();
        } catch {
          voice.classList.remove('recording');
          voice.disabled = false;
        }
      });

      // Lens: picker and submit
      lensBtn.addEventListener('click', () => lensFile.click());
      lensFile.addEventListener('change', () => {
        if (lensFile.files && lensFile.files.length) {
          lensForm.submit();
          lensForm.reset();
        }
      });

      // Drag-and-drop to Lens on the bar
      const isImage = f => f && f.type && f.type.startsWith('image/');
      const enableDropUI = () => bar.classList.add('drop-active');
      const disableDropUI = () => bar.classList.remove('drop-active');

      on(bar, 'dragenter dragover', (e) => {
        if (e.dataTransfer && Array.from(e.dataTransfer.types).includes('Files')) {
          e.preventDefault(); e.stopPropagation();
          enableDropUI();
          e.dataTransfer.dropEffect = 'copy';
        }
      });
      on(bar, 'dragleave dragend', () => disableDropUI());
      bar.addEventListener('drop', (e) => {
        e.preventDefault(); e.stopPropagation(); disableDropUI();
        const files = e.dataTransfer?.files;
        if (!files || !files.length || !isImage(files[0])) return;

        try {
          const dt = new DataTransfer();
          dt.items.add(files[0]);
          lensFile.files = dt.files;
          lensForm.submit();
          lensForm.reset();
        } catch {
          lensFile.click();
        }
      });

      // AI Mode -> Google search with UDM=50
      ai.addEventListener('click', () => {
        const v = q.value.trim();
        const base = 'https://www.google.com/search?udm=50';
        window.location.href = v ? `${base}&q=${encodeURIComponent(v)}` : base;
      });
    })();
  </script>
</body>
</html>