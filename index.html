<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Home</title>

  <link rel="preload" href="./wallpaper-dark.jpg" as="image" />
  <link rel="stylesheet" href="./styles/main.css" />
</head>
<body>
  <!-- Fixed top-center dock -->
  <div class="dock" aria-label="Search dock">
    <div id="bar" class="bar" role="search" aria-label="Search">
      <!-- Search form -->
      <form id="form" class="form" action="https://www.google.com/search" method="GET" autocomplete="off" target="_self">
        <input id="q" class="q" name="q" type="text" inputmode="search" spellcheck="false" aria-label="Search Google" placeholder="Search Google" role="combobox" aria-expanded="false" aria-autocomplete="list" aria-controls="suggest" aria-haspopup="listbox" />
      </form>

      <!-- Actions -->
      <div class="actions">
        <button id="go" class="btn" type="submit" form="form" title="Search" aria-label="Search">
          <svg aria-hidden="true" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8">
            <circle cx="11" cy="11" r="6"></circle>
            <path d="M16 16l5 5"></path>
          </svg>
        </button>
        <button id="voice" class="btn voice" title="Search by voice" aria-label="Search by voice">
          <!-- Icon will be set by JavaScript -->
        </button>
        <button id="lensBtn" class="btn lens" title="Search with lens" aria-label="Search with lens">
          <svg aria-hidden="true" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8">
            <path d="M3 7v10a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2H5a2 2 0 0 0-2-2z"></path>
            <path d="M8 21v-4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v4"></path>
            <circle cx="12" cy="11" r="2"></circle>
            <path d="m18 2 2 2"></path>
            <path d="m22 6-2-2"></path>
          </svg>
        </button>
        <button id="ai" class="btn ai" title="Search with AI" aria-label="Search with AI">
          <svg aria-hidden="true" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8">
            <path d="M12 6V2H8v4l4 0z"></path>
            <path d="M8 12V6L4 10l4 2z"></path>
            <path d="M12 18v4h4v-4h-4z"></path>
            <path d="M16 12V6l4 4-4 2z"></path>
            <circle cx="12" cy="12" r="3"></circle>
          </svg>
        </button>
      </div>

      <!-- Suggestions dropdown -->
      <ul id="suggest" class="suggest" role="listbox" aria-label="Search suggestions">
        <!-- Dynamically populated -->
      </ul>
    </div>
  </div>

  <!-- Shortcuts -->
  <section id="shortcuts" class="shortcuts" aria-label="Shortcuts">
    <div class="sc-bar">
      <div class="sc-title">Shortcuts</div>
      <div class="sc-actions">
        <button id="scAdd" class="btn tiny" title="Add shortcut" aria-label="Add shortcut">
          <svg aria-hidden="true" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M12 5v14M5 12h14"/>
          </svg>
        </button>
        <button id="scAddFolder" class="btn tiny" title="New folder" aria-label="New folder">
          <svg aria-hidden="true" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 2h9a2 2 0 0 1 2 2z"/>
            <path d="M12 11v6M9 14h6"/>
          </svg>
        </button>
        <button id="scExport" class="btn tiny" title="Export shortcuts" aria-label="Export shortcuts">
          <svg aria-hidden="true" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
            <polyline points="7,10 12,15 17,10"></polyline>
            <line x1="12" y1="15" x2="12" y2="3"></line>
          </svg>
        </button>
        <button id="scImport" class="btn tiny" title="Import shortcuts" aria-label="Import shortcuts">
          <svg aria-hidden="true" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M12 21V11"></path>
            <path d="M17 16l-5 5-5-5"></path>
            <path d="M19 3H5a2 2 0 0 0-2 2v5"></path>
          </svg>
        </button>
        <input id="scImportFile" type="file" accept="application/json,.json" style="display:none" />

        <button id="scEdit" class="btn tiny" title="Reorder / delete" aria-label="Edit" aria-pressed="false">
          <svg id="scEditIcon" aria-hidden="true" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M4 21h4l11-11a2.5 2.5 0 0 0-4-4L4 17v4z"></path>
          </svg>
        </button>
      </div>
    </div>
    
    <ul id="scGrid" class="tiles" role="list" aria-label="Shortcuts grid">
      <!-- Dynamically populated -->
    </ul>

    <!-- Folder View Overlay -->
    <div id="folderView" class="folder-view" aria-hidden="true">
      <div class="fv-bar">
        <div class="fv-left">
          <button id="fvBack" class="btn tiny" title="Back" aria-label="Back to main shortcuts">
            <svg aria-hidden="true" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M19 12H6m6-7-7 7 7 7"/>
            </svg>
          </button>
          <div id="fvTitle" class="fv-title">Folder</div>
        </div>
        <div class="fv-actions">
          <button id="fvAdd" class="btn tiny" title="Add shortcut" aria-label="Add shortcut to folder">
            <svg aria-hidden="true" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M12 5v14M5 12h14"/>
            </svg>
          </button>
          <button id="fvToggleEdit" class="btn tiny" title="Reorder / delete" aria-label="Edit folder items" aria-pressed="false">
            <svg id="fvToggleIcon" aria-hidden="true" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M4 21h4l11-11a2.5 2.5 0 0 0-4-4L4 17v4z"></path>
            </svg>
          </button>
        </div>
      </div>
      <ul id="fvGrid" class="fv-grid tiles" role="list" aria-label="Folder contents">
        <!-- Dynamically populated -->
      </ul>
    </div>
  </section>

  <!-- Dialog Overlay -->
  <div id="scOverlay" class="overlay" aria-hidden="true"></div>
  <div id="scDialog" class="sc-dialog" role="dialog" aria-labelledby="scDialogTitle" aria-modal="true" aria-hidden="true">
    <form id="scForm">
      <h3 id="scDialogTitle">Add Shortcut</h3>
      <div class="row">
        <label for="scTitle">Title</label>
        <input id="scTitle" type="text" name="title" placeholder="Enter title" />
      </div>
      <div class="row" id="rowUrl">
        <label for="scUrl">URL</label>
        <input id="scUrl" type="text" name="url" placeholder="Enter URL" />
      </div>
      <div class="row" id="rowLocation">
        <label id="scLocationLabel" for="scLocation">Add to</label>
        <select id="scLocation" name="location"></select>
      </div>
      <div class="actions">
        <button type="button" id="scCancel" class="btn ghost">Cancel</button>
        <button type="submit" class="btn primary">Save</button>
      </div>
    </form>
  </div>

  <script src="./js/utils.js"></script>
  <script src="./js/extension.js"></script>
  <script src="./js/search.js"></script>
  <script src="./js/shortcuts.js"></script>
  <script src="./js/ui.js"></script>
  <script src="./js/app.js"></script>

  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('./sw.js').then(registration => {
          // Trigger cache cleanup periodically (once per day)
          const lastCleanup = localStorage.getItem('sw-last-cleanup');
          const now = Date.now();
          const oneDayMs = 24 * 60 * 60 * 1000;
          
          if (!lastCleanup || (now - parseInt(lastCleanup)) > oneDayMs) {
            // Trigger cache cleanup
            if (registration.active) {
              registration.active.postMessage({ type: 'CLEANUP_CACHE' });
            }
            localStorage.setItem('sw-last-cleanup', now.toString());
          }
        }).catch(() => {});
      });
    }
  </script>
</body>
</html>